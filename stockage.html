
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Les espaces de stockage &#8212; CIP201 - Maîtriser l’utilisation des serveurs de calcul</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="prev" title="Lots de tâches" href="lots-taches.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CIP201 - Maîtriser l’utilisation des serveurs de calcul</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Rechercher dans ce livre ..." aria-label="Rechercher dans ce livre ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="a_propos.html">
   À propos
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ressources.html">
   Bien choisir les ressources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="analyse-taches.html">
   Analyse des tâches
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lots-taches.html">
   Lots de tâches
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Les espaces de stockage
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Basculer la navigation" aria-controls="site-navigation"
                title="Basculer la navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Téléchargez cette page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/stockage.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Télécharger le fichier source" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Imprimer au format PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/calculquebec/utilisation-serveurs-calcul"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Dépôt source"><i
                    class="fab fa-github"></i>dépôt</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Mode plein écran"
        title="Mode plein écran"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contenu
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#description-de-vos-donnees">
   Description de vos données
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transferabilite">
     Transférabilité
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regroupement-dans-un-fichier-archive">
       Regroupement dans un fichier archive
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compression">
       Compression
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercice-dar">
       Exercice - DAR
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercice-espace-utilise">
       Exercice - Espace utilisé
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-epars-sparse-files">
       Fichiers épars (sparse files)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plan-de-gestion-des-donnees-actives">
     Plan de gestion des données actives
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vie-des-donnees">
       Vie des données
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#niveaux-d-acces">
       Niveaux d’accès
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#les-differents-types-de-stockage">
   Les différents types de stockage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votre-dossier-personnel-home">
     Votre dossier personnel (
     <code class="docutils literal notranslate">
      <span class="pre">
       /home
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dossier-temporaire-local-slurm-tmpdir">
     Dossier temporaire local (
     <code class="docutils literal notranslate">
      <span class="pre">
       $SLURM_TMPDIR
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#espace-reseau-pour-donnees-temporaires-scratch">
     Espace réseau pour données temporaires (
     <code class="docutils literal notranslate">
      <span class="pre">
       /scratch
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#espace-projet-partage-project">
     Espace projet partagé (
     <code class="docutils literal notranslate">
      <span class="pre">
       /project
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stockage-tres-longue-duree-nearline">
     Stockage très longue durée (
     <code class="docutils literal notranslate">
      <span class="pre">
       /nearline
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exemples-de-cycles-de-vie-des-donnees">
     Exemples de cycles de vie des données
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exemple-de-pipeline-1">
       Exemple de pipeline 1
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exemple-de-pipeline-2">
       Exemple de pipeline 2
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercice-execution-d-un-pipeline">
       Exercice - Exécution d’un pipeline
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gestion-du-stockage">
   Gestion du stockage
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="les-espaces-de-stockage">
<h1>Les espaces de stockage<a class="headerlink" href="#les-espaces-de-stockage" title="Lien permanent vers ce titre">¶</a></h1>
<p>Il y a plusieurs types de stockage à l’Alliance de Recherche numérique du Canada :</p>
<ul class="simple">
<li><p>Personnel (<code class="docutils literal notranslate"><span class="pre">/home</span></code>)</p></li>
<li><p>Temporaire local (<code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code>)</p></li>
<li><p>Temporaire réseau (<code class="docutils literal notranslate"><span class="pre">/scratch</span></code>)</p></li>
<li><p>Projet partagé (<code class="docutils literal notranslate"><span class="pre">/project</span></code>)</p></li>
<li><p><em>Nearline</em> de longue durée (<code class="docutils literal notranslate"><span class="pre">/nearline</span></code>)</p></li>
<li><p><a class="reference external" href="https://www.frdr-dfdr.ca/repo/">Dépôt fédéré de données de recherche</a> (DFDR)</p></li>
</ul>
<p>Or, vos données ont plusieurs aspects :</p>
<ul class="simple">
<li><p><strong>Taille</strong> : petits, gros, très gros fichiers</p></li>
<li><p><strong>Nombre</strong> : peu nombreux ou en très grand nombre</p></li>
<li><p><strong>Transférabilité</strong> : données regroupées et/ou compressées</p></li>
<li><p><strong>Vie</strong> : pendant une tâche, entre des tâches, d’un projet à l’autre, à archiver</p></li>
<li><p><strong>Niveau d’accès</strong> : données confidentielles, partagées, publiées</p></li>
</ul>
<p>Le but de ce chapitre est de pouvoir considérer tous les aspects nécessaires à la gestion des données actives sur les différents espaces de stockage disponibles.</p>
<div class="section" id="description-de-vos-donnees">
<h2>Description de vos données<a class="headerlink" href="#description-de-vos-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Au chapitre précédent, nous avons vu comment obtenir le nombre de fichiers de nos données locales, de même que la taille totale.</p>
<p>Sur une grappe de calcul, un <strong>système de fichiers parallel</strong>
<a class="reference external" href="https://docs.computecanada.ca/wiki/Tuning_Lustre/fr"><em>Lustre</em></a> ou <em>GPFS</em>
est surtout optimisé pour des fichiers de plus de 10 Mo,
c’est-à-dire pour des accès à large bande-passante. Ainsi, à l’échelle des
<a class="reference external" href="https://docs.computecanada.ca/wiki/B%C3%A9luga#Stockage">grappes de calcul</a> :</p>
<ul class="simple">
<li><p>1 Ko - 100 Ko : très petit fichier</p></li>
<li><p>1 Mo - 10 Mo : petit fichier</p></li>
<li><p>100 Mo - 1 Go : taille raisonnable</p></li>
<li><p>10 Go - 100 Go : gros fichier</p></li>
<li><p>1 To - 10 To : très gros fichier</p></li>
</ul>
<p>À quantité totale égale d’octets, il est plus difficile pour <em>Lustre</em> de gérer un grand nombre de petits fichiers qu’un plus petit nombre de grands fichiers. Ainsi, du point de vue du système de stockage :</p>
<ul class="simple">
<li><p>Par dossier :</p>
<ul>
<li><p>1 à 100 fichiers par dossier : c’est raisonnable</p></li>
<li><p>1000 à 5k fichiers par dossier : des lenteurs se font sentir</p></li>
<li><p>10k fichiers et plus : il faut classer les fichiers dans des sous-dossiers</p></li>
</ul>
</li>
<li><p>Par espace <a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Quotas_et_politiques">limité par un quota</a> :</p>
<ul>
<li><p>1 à 500k fichiers : sauvegarde facilement à jour</p></li>
<li><p>1M à 5M fichiers : sauvegarde potentiellement plus longue que 24h</p></li>
<li><p>10M fichiers et plus : sauvegarde plus longue que 24h</p></li>
</ul>
</li>
</ul>
<div class="section" id="transferabilite">
<h3>Transférabilité<a class="headerlink" href="#transferabilite" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="regroupement-dans-un-fichier-archive">
<h4>Regroupement dans un fichier archive<a class="headerlink" href="#regroupement-dans-un-fichier-archive" title="Lien permanent vers ce titre">¶</a></h4>
<p>Étant donné que le transfert ou la synchronisation de <a class="reference external" href="https://docs.computecanada.ca/wiki/Handling_large_collections_of_files/fr">plusieurs petits fichiers</a> implique un accès fréquent aux métadonnées du système de stockage <em>Lustre</em>, il est donc préférable de <a class="reference external" href="https://docs.computecanada.ca/wiki/Archiving_and_compressing_files/fr">regrouper les fichiers</a> d’un jeu de données avant tout transfert.
Pour ce faire, il existe plusieurs formats décodables sur les différentes grappes :</p>
<ul class="simple">
<li><p>WinZip ou Zip (<code class="docutils literal notranslate"><span class="pre">.zip</span></code>) - compressé</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="nb">zip</span>  <span class="c1"># q pour quitter</span>
</pre></div>
</div>
<ul class="simple">
<li><p>7-Zip (<code class="docutils literal notranslate"><span class="pre">.7z</span></code>) - compressé</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="mi">7</span><span class="n">z</span>  <span class="c1"># q pour quitter</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Tape ARchive ou <a class="reference external" href="https://docs.computecanada.ca/wiki/A_tutorial_on_%27tar%27/fr">TAR</a> (<code class="docutils literal notranslate"><span class="pre">.tar</span></code>) - non compressé, sauf si utilisé avec Gzip ou autre</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="n">tar</span>  <span class="c1"># q pour quitter</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Disk ARchive ou <a class="reference external" href="https://docs.computecanada.ca/wiki/Dar/fr">DAR</a> (<code class="docutils literal notranslate"><span class="pre">.dar</span></code>) - compression configurable</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="n">dar</span>  <span class="c1"># q pour quitter</span>
</pre></div>
</div>
</div>
<div class="section" id="compression">
<h4>Compression<a class="headerlink" href="#compression" title="Lien permanent vers ce titre">¶</a></h4>
<p>La <a class="reference external" href="https://docs.computecanada.ca/wiki/Archiving_and_compressing_files/fr">compression des fichiers</a> a un <strong>coût en temps CPU</strong> à chaque fois que nous voulons lire les données ou les écrire.</p>
<ul class="simple">
<li><p>Ainsi, il vaut mieux utiliser la compression <strong>lorsque c’est « avantageux »</strong> en espace et/ou en temps.</p>
<ul>
<li><p>Par exemple : décompression des fichiers sur le noeud de calcul plutôt que de lire chaque fichier de <em>Lustre</em>.</p></li>
</ul>
</li>
</ul>
<p>Concernant les fichiers binaires tels que FLAC, JPEG, PNG, etc., leur encodage <strong>inclut déjà une compression</strong> des données.</p>
<ul class="simple">
<li><p>Selon le type de données que vous utilisez dans votre domaine de recherche, il se pourrait qu’elles soient déjà compressées. À vous de vérifier.</p></li>
<li><p>Habituellement, on gagne peu d’espace à compresser davantage ces fichiers.</p></li>
</ul>
</div>
<div class="section" id="exercice-dar">
<h4>Exercice - DAR<a class="headerlink" href="#exercice-dar" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans un terminal :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dar</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">c</span> <span class="n">dossiers</span> <span class="o">-</span><span class="n">g</span> <span class="n">images</span> <span class="o">-</span><span class="n">g</span> <span class="n">scripts</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-w</span></code> : pour éviter un avertissement d’écrasement d’archive existante</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span></code> : pour créer l’archive <code class="docutils literal notranslate"><span class="pre">dossiers</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span></code> : pour spécifier un fichier ou dossier à la fois</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dar</span> <span class="o">-</span><span class="n">l</span> <span class="n">dossiers</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code> : pour lister les fichiers dans l’archive DAR <code class="docutils literal notranslate"><span class="pre">dossiers</span></code></p></li>
<li><p>Note : <strong>ne pas</strong> fournir le nom d’une <em>slice</em> avec l’extension <code class="docutils literal notranslate"><span class="pre">.1.dar</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dar</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">c</span> <span class="n">dossiers</span> <span class="o">-</span><span class="n">g</span> <span class="n">images</span> <span class="o">-</span><span class="n">g</span> <span class="n">scripts</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-z</span></code> : pour activer la compression</p></li>
<li><p>Voir le résultat avec <code class="docutils literal notranslate"><span class="pre">dar</span> <span class="pre">-l</span> <span class="pre">dossiers</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dar</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">Z</span> <span class="s1">&#39;*.png&#39;</span> <span class="o">-</span><span class="n">c</span> <span class="n">dossiers</span> <span class="o">-</span><span class="n">g</span> <span class="n">images</span> <span class="o">-</span><span class="n">g</span> <span class="n">scripts</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-Z</span> <span class="pre">'*.png'</span></code> : pour exclure les fichiers PNG</p></li>
<li><p>Voir le résultat avec <code class="docutils literal notranslate"><span class="pre">dar</span> <span class="pre">-l</span> <span class="pre">dossiers</span></code></p></li>
</ul>
<p>Sur les grappes de calcul, il y a deux (2) types de compression :</p>
<ol class="simple">
<li><p>Compression explicite :</p></li>
</ol>
<ul class="simple">
<li><p>Lorsque vous utilisez un outil de compression (<code class="docutils literal notranslate"><span class="pre">7z</span></code>, <code class="docutils literal notranslate"><span class="pre">bzip2</span></code>, <code class="docutils literal notranslate"><span class="pre">gzip</span></code>, <code class="docutils literal notranslate"><span class="pre">zip</span></code>, etc.)</p></li>
<li><p>Lorsque l’encodage permet de compresser les données (<code class="docutils literal notranslate"><span class="pre">dar</span></code>, bibliothèque <code class="docutils literal notranslate"><span class="pre">zlib</span></code>, etc.)</p></li>
<li><p>Lors d’un transfert avec <code class="docutils literal notranslate"><span class="pre">rsync</span></code>, il existe des options permettant de compresser automatiquement les données lors du transfert. Cela étant dit, le transfert risque d’être limité par la vitesse du processeur…</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="n">rsync</span>  <span class="c1"># Chercher: /compress + n, Quitter: q</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Compression implicite :</p></li>
</ol>
<ul class="simple">
<li><p>Lorsque le système de fichiers compresse automatiquement vos données avant de les écrire sur le système de stockage</p>
<ul>
<li><p>La commande <code class="docutils literal notranslate"><span class="pre">du</span></code> montre l’espace réellement utilisée sur le disque</p></li>
<li><p>La commande <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">--apparent-size</span></code> montre la taille normale du fichier</p></li>
</ul>
</li>
<li><p>Lorsque le format du fichier de données inclut une compression des données. Par exemple :</p>
<ul>
<li><p><a class="reference external" href="https://docs.computecanada.ca/wiki/HDF5/fr">Hierarchical Data Format - HDF5</a> - format standard pour données scientifiques</p></li>
<li><p><a class="reference external" href="https://parquet.apache.org/documentation/latest/">Apache Parquet</a> - stockage compressé de données tabulaires</p>
<ul>
<li><p>Note: l’autre format, <a class="reference external" href="https://arrow.apache.org/docs/python/feather.html">Apache Feather</a>, ne compresse pas vraiment les données, sauf si on considère que c’est un format binaire prenant moins de place</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="exercice-espace-utilise">
<h4>Exercice - Espace utilisé<a class="headerlink" href="#exercice-espace-utilise" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans un terminal Jupyter, essayez les commandes :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-s</span> <span class="pre">~</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-s</span> <span class="pre">--apparent-size</span> <span class="pre">~</span></code></p></li>
<li><p>Notez les différences, s’il y en a</p></li>
<li><p>Notez à quel point cette commande peut surcharger le système de stockage; le survol récursif des fichiers constitue un grand nombre d’accès aux métadonnées de <em>Lustre</em></p></li>
</ul>
<p>En pratique, les grappes de calcul offrent des outils efficaces pour mesurer l’espace utilisé en fonction de l’espace alloué.
Nous verrons cela à la fin du chapitre.</p>
</div>
<div class="section" id="fichiers-epars-sparse-files">
<h4>Fichiers épars (sparse files)<a class="headerlink" href="#fichiers-epars-sparse-files" title="Lien permanent vers ce titre">¶</a></h4>
<p>Restez à l’affût des fichiers épars dont la faible taille sur le disque n’est pas représentative de la taille normale du fichier :</p>
<ul class="simple">
<li><p>Une certaine taille <code class="docutils literal notranslate"><span class="pre">T</span></code> est allouée pour le fichier. Par exemple : 1 To</p></li>
<li><p>Seulement <code class="docutils literal notranslate"><span class="pre">t</span></code> octets sont réellement écrits dans le fichier (où <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">&lt;&lt;</span> <span class="pre">T</span></code>). Par exemple : 1 Go</p></li>
<li><p>Ce type de fichiers est typiquement utilisé pour des volumes de stockage de machines virtuelles, ce qui économise de l’espace sur le serveur hôte</p></li>
<li><p>Problème : lors d’un transfert ou d’une sauvegarde (backup), ce sont les <code class="docutils literal notranslate"><span class="pre">T</span></code> octets qui sont lus, ce qui peut être catastrophique si <code class="docutils literal notranslate"><span class="pre">T</span></code> est vraiment très grand</p></li>
<li><p><strong>Solution</strong> : les fichiers <code class="docutils literal notranslate"><span class="pre">.dar</span></code> permettent d’optimiser l’encapsulation de fichiers épars avant un transfert ou une copie des données</p></li>
</ul>
</div>
</div>
<div class="section" id="plan-de-gestion-des-donnees-actives">
<h3>Plan de gestion des données actives<a class="headerlink" href="#plan-de-gestion-des-donnees-actives" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les données sur les grappes de calcul sont généralement présentes en attente d’être traitées, manipulées ou publiées, d’où la notion de <em>données actives</em>. Or, il y a une planification à faire et des questions à se poser.</p>
<div class="section" id="vie-des-donnees">
<h4>Vie des données<a class="headerlink" href="#vie-des-donnees" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><p><strong>Durée de vie variable</strong> - avons-nous affaire à des données temporaires ou à des données persistantes?</p>
<ul>
<li><p>Utilisées (à répétition ou non) pendant une seule tâche de calcul?</p></li>
<li><p>Utilisées entre deux tâches de calcul?</p></li>
<li><p>Utilisées pour plusieurs calculs par plusieurs personnes?</p></li>
<li><p>Peut-on importer à nouveau les données en cas de perte?</p></li>
<li><p>Peut-on recalculer les données en cas de perte? Si oui, à quel coût?</p></li>
</ul>
</li>
<li><p><strong>Fréquence d’accès</strong> - combien de temps sépare les différents accès?</p>
<ul>
<li><p>Utilisation courante (à chaque jour, semaine ou mois)?</p></li>
<li><p>Données à garder pour plus tard, par exemple pour reproduire les résultats?</p></li>
<li><p>Données à publier sur des dépôts de données de recherche?</p></li>
</ul>
</li>
</ul>
<p>Si aucune planification n’est faite, les données temporaires s’accumulent et prennent de la place dans l’espace alloué qui est de taille limitée. Si les données sont mal décrites, leur identification, leur compréhension et leur publication deviennent des tâches laborieuses pour les personnes qui en héritent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">.</span><span class="n">gitignore</span>  <span class="c1"># Fichiers à ignorer, car temporaires</span>
<span class="n">cat</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>   <span class="c1"># Description du projet</span>
</pre></div>
</div>
</div>
<div class="section" id="niveaux-d-acces">
<h4>Niveaux d’accès<a class="headerlink" href="#niveaux-d-acces" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><p>Quel est le <strong>niveau de confidentialité</strong> de vos données?</p>
<ul>
<li><p><strong>Qui</strong> devrait avoir accès à quelles données?</p></li>
<li><p><strong>Où</strong> pouvez-vous héberger vos données?</p></li>
</ul>
</li>
<li><p><strong>Quand</strong> : qui devrait avoir accès à vos données à votre départ?</p></li>
</ul>
<p>Référez-vous aux <strong>politiques de votre université</strong> concernant la gestion des données de recherche.
Dans tous les cas, sans précaution, les données que vous laissez sur les grappes de calcul risquent de ne pas être accessibles aux membres d’un laboratoire qui poursuivent leur recherche.</p>
<p>Dès que possible, mettez en place les accès nécessaires pour le <a class="reference external" href="https://docs.computecanada.ca/wiki/Sharing_data/fr">partage de vos données</a>.</p>
</div>
</div>
</div>
<div class="section" id="les-differents-types-de-stockage">
<h2>Les différents types de stockage<a class="headerlink" href="#les-differents-types-de-stockage" title="Lien permanent vers ce titre">¶</a></h2>
<p>Stockage accessible selon le type de noeud :</p>
<ul class="simple">
<li><p>Noeud de connexion (ou interactif)</p></li>
<li><p>Noeud de calcul (CPU ou GPU)</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Stockage</p></th>
<th class="text-align:center head"><p>Connexion</p></th>
<th class="text-align:center head"><p>Calcul</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/home</span></code></p></td>
<td class="text-align:center"><p>Oui</p></td>
<td class="text-align:center"><p>Oui*</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code></p></td>
<td class="text-align:center"><p><strong>Non</strong></p></td>
<td class="text-align:center"><p>Oui</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></td>
<td class="text-align:center"><p>Oui</p></td>
<td class="text-align:center"><p>Oui</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/project</span></code></p></td>
<td class="text-align:center"><p>Oui</p></td>
<td class="text-align:center"><p>Oui</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/nearline</span></code></p></td>
<td class="text-align:center"><p>Oui</p></td>
<td class="text-align:center"><p><strong>Non</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> En lecture-seule sur Cedar</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
</tbody>
</table>
<p>À propos des <a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Types_de_stockage">différents espaces de stockage</a>.</p>
<div class="section" id="votre-dossier-personnel-home">
<h3>Votre dossier personnel (<code class="docutils literal notranslate"><span class="pre">/home</span></code>)<a class="headerlink" href="#votre-dossier-personnel-home" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls -a
ls -la
ls -ld $HOME
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Point d’entrée</strong> par défaut lors d’une connexion à une grappe de calcul</p></li>
<li><p><a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Quotas_et_politiques">Quota d’espace relativement petit</a>, mais accepte un nombre de fichiers relativement grand</p>
<ul>
<li><p>Idéal pour la <a class="reference external" href="https://docs.computecanada.ca/wiki/Installing_software_in_your_home_directory/fr">compilation et l’installation de logiciels</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="dossier-temporaire-local-slurm-tmpdir">
<h3>Dossier temporaire local (<code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code>)<a class="headerlink" href="#dossier-temporaire-local-slurm-tmpdir" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls -ld $SLURM_TMPDIR
salloc
  ls -ld $SLURM_TMPDIR
  df -h $SLURM_TMPDIR
  exit
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.computecanada.ca/wiki/Using_node-local_storage/fr">Stockage local très rapide</a>, mais limité à la durée de la tâche de calcul</p>
<ul>
<li><p>Faible latence à comparé <em>Lustre</em></p></li>
<li><p>Grande bande-passante, en particulier pour les petits fichiers</p></li>
<li><p><strong>Données supprimées à la fin</strong> de la tâche de calcul</p></li>
<li><p>Si plusieurs noeuds travaillent sur un même calcul parallèle, <strong>chaque noeud a son propre dossier</strong> <code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code></p></li>
</ul>
</li>
<li><p>Cas d’utilisation :</p>
<ul>
<li><p><strong>Importation</strong> de plusieurs <strong>petits fichiers</strong> qui seront utilisés à répétition lors d’un calcul</p></li>
<li><p><strong>Sauvegarde</strong> de fichiers qui sont <strong>constamment modifiés</strong> - à exporter vers Lustre à la fin du calcul</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="espace-reseau-pour-donnees-temporaires-scratch">
<h3>Espace réseau pour données temporaires (<code class="docutils literal notranslate"><span class="pre">/scratch</span></code>)<a class="headerlink" href="#espace-reseau-pour-donnees-temporaires-scratch" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>df -h /scratch
ls -ld $SCRATCH

# Enlever l&#39;accès en lecture
chmod g-r $SCRATCH
ls -ld $SCRATCH

# Modifier le GID du répertoire
id
chgrp def-sponsor00 $SCRATCH
ls -ld $SCRATCH
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Création d&#39;un dossier de résultats partagés
mkdir -p $SCRATCH/partage/resultats
ls -lR $SCRATCH

# Ajouter les permissions r (et x, s&#39;il y a lieu) récursivement
chmod -R o+rX $SCRATCH/partage
ls -lR $SCRATCH
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Visiter le dossier partagé de quelqu&#39;un d&#39;autre
cd /scratch/userXY/partage
pwd
ls -l
cd $HOME
</pre></div>
</div>
<ul class="simple">
<li><p>Espace de stockage réseau de <a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Quotas_et_politiques">grande capacité</a> pour des <strong>données temporaires</strong></p>
<ul>
<li><p><strong>Pas</strong> sauvegardé</p></li>
<li><p><a class="reference external" href="https://docs.computecanada.ca/wiki/Scratch_purging_policy/fr">Purge mensuelle</a> pour les données âgées de plus de 60 jours</p></li>
</ul>
</li>
<li><p>Performance variable selon l’utilisation de l’ensemble des utilisateurs</p></li>
<li><p>Cas d’utilisation :</p>
<ul>
<li><p>Utilisation de données <strong>pendant quelques jours</strong> seulement</p></li>
<li><p>Stocker temporairement des <strong>résultats en grand nombre</strong> de fichiers</p></li>
<li><p>Stocket des résultats <strong>intermédiaires</strong> qui sont <strong>trop gros</strong> pour <code class="docutils literal notranslate"><span class="pre">/project</span></code></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="espace-projet-partage-project">
<h3>Espace projet partagé (<code class="docutils literal notranslate"><span class="pre">/project</span></code>)<a class="headerlink" href="#espace-projet-partage-project" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">ld</span> <span class="o">/</span><span class="n">project</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">ld</span> <span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">def</span><span class="o">-</span><span class="n">sponsor00</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">def</span><span class="o">-</span><span class="n">sponsor00</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Espace de stockage réseau de <a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Quotas_et_politiques">petite à grande capacité</a> pour des <strong>données de projet</strong></p>
<ul>
<li><p>Un espace projet par défaut par groupe de recherche (sauf sur Niagara)</p>
<ul>
<li><p>Petite augmentation d’espace projet <strong>sur simple demande (jusqu’à 10 To)</strong></p></li>
<li><p>Quota plus élevé si <a class="reference external" href="https://www.computecanada.ca/page-daccueil-du-portail-de-recherche/acces-aux-ressources/concours-dallocation-des-ressources/ressources-pour-les-groupes-de-recherche-crgr/?lang=fr">allocation spéciale</a></p></li>
</ul>
</li>
<li><p>Sauvegardé <strong>quotidiennement</strong></p>
<ul>
<li><p>Nombre de fichiers relativement limité</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Données de projet :</p>
<ul>
<li><p>Potentiellement <strong>partagées</strong> - <a class="reference external" href="https://docs.computecanada.ca/wiki/Sharing_data/fr">configuration des ACLs</a></p></li>
<li><p>Durée de vie en fonction de la durée d’un projet</p></li>
<li><p>Typiquement plus importantes que les données temporaires</p></li>
</ul>
</li>
<li><p>Cas d’utilisation :</p>
<ul>
<li><p>Stockage de jeux de données <strong>réutilisés sur plusieurs mois et/ou par plusieurs personnes</strong></p></li>
<li><p>Stockage de <strong>résultats finaux</strong> coûteux à reproduire</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="stockage-tres-longue-duree-nearline">
<h3>Stockage très longue durée (<code class="docutils literal notranslate"><span class="pre">/nearline</span></code>)<a class="headerlink" href="#stockage-tres-longue-duree-nearline" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li><p>Malgré une interface de stockage sur disque (on peut voir les fichiers avec la commande <code class="docutils literal notranslate"><span class="pre">ls</span></code>), les données les plus anciennes dans <a class="reference external" href="https://docs.computecanada.ca/wiki/Using_nearline_storage/fr"><code class="docutils literal notranslate"><span class="pre">/nearline</span></code> sont probablement sur ruban</a></p>
<ul>
<li><p>Voir les commandes pour <a class="reference external" href="https://docs.computecanada.ca/wiki/Using_nearline_storage/fr#Transf.C3.A9rer_des_donn.C3.A9es_.C3.A0_partir_de_.2Fnearline">diagnostiquer l’état des fichiers</a> dans <code class="docutils literal notranslate"><span class="pre">/nearline</span></code></p></li>
<li><p>D’une part, la migration de données sur ruban réduit l’espace utilisé sur les disques - économie d’argent pour le stockage</p></li>
<li><p>D’autre part, chaque lecture de fichier migré sur ruban créera <strong>une requête bloquante</strong> causant un temps de réponse de quelques minutes à quelques heures (si le système d’archivage est surchargé de requêtes)</p>
<ul>
<li><p>Voilà pourquoi il est impératif d’y sauvegarder un faible nombre de très grands fichiers</p></li>
<li><p><strong>À éviter</strong> : y copier de nombreux petits fichiers avant de les regrouper dans un fichier d’archive</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Cas d’utilisation :</p>
<ul>
<li><p>Les commandes <code class="docutils literal notranslate"><span class="pre">7z</span></code>, <code class="docutils literal notranslate"><span class="pre">dar</span></code>, <code class="docutils literal notranslate"><span class="pre">tar</span></code> et <code class="docutils literal notranslate"><span class="pre">zip</span></code> devraient uniquement regrouper des fichiers provenant de <code class="docutils literal notranslate"><span class="pre">/project</span></code> ou de <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></li>
<li><p>Stockage de données importantes <strong>qui ne seront pas utilisées pendant plusieurs mois</strong></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="exemples-de-cycles-de-vie-des-donnees">
<h3>Exemples de cycles de vie des données<a class="headerlink" href="#exemples-de-cycles-de-vie-des-donnees" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="exemple-de-pipeline-1">
<h4>Exemple de pipeline 1<a class="headerlink" href="#exemple-de-pipeline-1" title="Lien permanent vers ce titre">¶</a></h4>
<p><img alt="Pipeline 1" src="_images/data-flow-1.png" /></p>
<p>Description des différentes étapes :</p>
<ul class="simple">
<li><p>Téléchargement des données dans <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p>
<ul>
<li><p>Pour une utilisation de quelques jours à quelques semaines</p></li>
<li><p>Nul besoin de les protéger davantage</p></li>
</ul>
</li>
<li><p>Soumettre une série de tâches de calcul</p>
<ul>
<li><p>Une tâche par fichier dans <code class="docutils literal notranslate"><span class="pre">dossier</span></code> dans la partition <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></li>
</ul>
</li>
<li><p>Le script de tâche est dans la partition <code class="docutils literal notranslate"><span class="pre">/home</span></code></p>
<ul>
<li><p>Utilisation des variables <code class="docutils literal notranslate"><span class="pre">$FIC</span></code> et <code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code> pour copier le fichier à traiter localement sur le noeud de calcul</p></li>
<li><p>Se déplacer dans le dossier local</p></li>
<li><p>Y configurer un environnement Python</p></li>
<li><p>Exécuter le code Python présent dans <code class="docutils literal notranslate"><span class="pre">/home</span></code>, fournir le nom du fichier à traiter et rediriger toutes les sorties dans un fichier local</p></li>
<li><p>Rapatrier le fichier de résultats dans un dossier dans <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></li>
</ul>
</li>
<li><p>Post-traitement - traiter tous les fichiers de résultats afin de ne garder que l’essentiel dans <code class="docutils literal notranslate"><span class="pre">/project</span></code></p></li>
</ul>
</div>
<div class="section" id="exemple-de-pipeline-2">
<h4>Exemple de pipeline 2<a class="headerlink" href="#exemple-de-pipeline-2" title="Lien permanent vers ce titre">¶</a></h4>
<p><img alt="Pipeline 2" src="_images/data-flow-2.png" /></p>
<p>Description des différentes étapes :</p>
<ul class="simple">
<li><p>Téléchargement des données dans <code class="docutils literal notranslate"><span class="pre">/project</span></code></p>
<ul>
<li><p>Pour un partage des données</p></li>
<li><p>Pour une réutilisation à moyen-long terme</p></li>
</ul>
</li>
<li><p>Soumettre une série de tâches de calcul</p>
<ul>
<li><p>Une tâche par <em>cas</em> (un sous-dossier de données) dans <code class="docutils literal notranslate"><span class="pre">dossier</span></code> dans la partition <code class="docutils literal notranslate"><span class="pre">/project</span></code></p></li>
</ul>
</li>
<li><p>Le script de tâche est dans la partition <code class="docutils literal notranslate"><span class="pre">/home</span></code></p>
<ul>
<li><p>Utilisation des variables <code class="docutils literal notranslate"><span class="pre">$CAS</span></code> et <code class="docutils literal notranslate"><span class="pre">$SLURM_SUBMIT_DIR</span></code> pour le chemin complet vers le <em>cas</em> à étudier (situé dans <code class="docutils literal notranslate"><span class="pre">/project</span></code>)</p></li>
<li><p>Se déplacer dans le dossier local <code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code> du noeud de calcul</p></li>
<li><p>Exécution de scripts présents dans <code class="docutils literal notranslate"><span class="pre">/home</span></code></p></li>
<li><p>Toute la trace d’exécution est sauvegardée dans un fichier créé dans <code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code></p></li>
<li><p>À chaque itération globale, tous les fichiers archives dans le sous-dossier du <em>cas</em> (présent dans <code class="docutils literal notranslate"><span class="pre">/project</span></code>) sont traités :</p>
<ul>
<li><p>Le traitement consiste à extraire localement les données groupées et compressées</p></li>
<li><p>Les données extraites sont dans un dossier local <code class="docutils literal notranslate"><span class="pre">donnees</span></code></p></li>
</ul>
</li>
<li><p>Rapatrier le fichier de résultats dans un dossier dans <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></li>
</ul>
</li>
<li><p>Post-traitement - traiter tous les fichiers de résultats :</p>
<ul>
<li><p>Conversion en format CSV dans <code class="docutils literal notranslate"><span class="pre">/scratch</span></code></p></li>
<li><p>Regrouper les fichiers CSV dans la partition <code class="docutils literal notranslate"><span class="pre">/project</span></code> où il y a de la compression implicite</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="exercice-execution-d-un-pipeline">
<h4>Exercice - Exécution d’un pipeline<a class="headerlink" href="#exercice-execution-d-un-pipeline" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><p>Étudier les scripts :</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">scripts/nbody-pipeline.sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scripts/nbody-traitement.sh</span></code></p></li>
</ul>
</li>
<li><p>Lancer le pipeline avec la commande <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">scripts/nbody-pipeline.sh</span></code></p></li>
<li><p>Surveiller les tâches avec <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">-u</span> <span class="pre">$USER</span></code></p></li>
<li><p>Trouver les fichiers créés dans <code class="docutils literal notranslate"><span class="pre">/scratch/$USER/resultats</span></code></p></li>
<li><p>Lancer le post-traitement avec la commande <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">scripts/nbody-traitement.sh</span></code></p></li>
<li><p>Trouver le fichier TSV dans l’espace projet</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="gestion-du-stockage">
<h2>Gestion du stockage<a class="headerlink" href="#gestion-du-stockage" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avec le temps, les données s’accumulent. Il devient alors nécessaire de surveiller l’espace utilisé, de même que le nombre de fichiers qui s’y trouvent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">-</span><span class="n">h</span> <span class="o">/</span><span class="n">project</span>
<span class="n">df</span> <span class="o">-</span><span class="n">hi</span> <span class="o">/</span><span class="n">project</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.computecanada.ca/wiki/Storage_and_file_management/fr#Introduction">La commande <code class="docutils literal notranslate"><span class="pre">diskusage_report</span></code></a> permet de générer un court rapport sur l’espace utilisé et le nombre de fichiers de chacun des espaces de stockage auxquels vous avez accès</p></li>
<li><p>À chaque jour, un rapport de consommation de l’espace <code class="docutils literal notranslate"><span class="pre">/project</span></code> par utilisateur est produit :</p>
<ul>
<li><p>Sur Béluga : dans <code class="docutils literal notranslate"><span class="pre">/project/.stats/&lt;nom-allocation&gt;</span></code></p></li>
<li><p>Sur Cedar : dans <code class="docutils literal notranslate"><span class="pre">/project/.stats/&lt;nom-allocation&gt;.json</span></code></p></li>
<li><p>Disponible sur demande pour Graham et Niagara</p></li>
</ul>
</li>
<li><p>Sur Béluga, il existe aussi un outil plus avancé : <a class="reference external" href="https://docs.computecanada.ca/wiki/Diskusage_Explorer/fr"><code class="docutils literal notranslate"><span class="pre">diskusage_explorer</span></code></a></p>
<ul>
<li><p>Utilise les données en format SQLite générées quotidiennement dans <code class="docutils literal notranslate"><span class="pre">/project/.duc_databases/</span></code></p></li>
<li><p>Permet d’avoir des statistiques de consommation du stockage par répertoire, ce qui évite d’utiliser la commande <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sh</span> <span class="pre">*</span></code></p></li>
</ul>
</li>
</ul>
<p>En cas de données inaccessibles :</p>
<ul class="simple">
<li><p>Une professeure ou un professeur peut demander à ce que les données soient supprimées</p></li>
<li><p>Par contre, pour obtenir l’accès aux données, il faut avoir le consentement de la personne qui les a isolées (probablement involontairement)</p>
<ul>
<li><p>En cas d’absence de réponse, c’est la politique de l’université du groupe de recherche qui permettra ou non d’obtenir l’accès aux données</p></li>
</ul>
</li>
</ul>
<p>Dans tous les cas, il vaut mieux prévenir, et ce, dès l’importation de données sur les grappes de calcul.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="lots-taches.html" title="précédent page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">précédent</p>
                <p class="prevnext-title">Lots de tâches</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          Par Équipe Calcul Québec<br/>
        
            &copy; droits d'auteur 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>