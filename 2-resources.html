
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Use Resources Wisely &#8212; CIP201 - Mastering the Alliance&#39;s Compute Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2-resources';</script>
    <link rel="icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Task Arrays for Data Parallelism" href="3-task-arrays.html" />
    <link rel="prev" title="Introduction" href="1-introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="0-about.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="CIP201 - Mastering the Alliance's Compute Systems - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="CIP201 - Mastering the Alliance's Compute Systems - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0-about.html">
                    Mastering the Alliance’s Compute Systems
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Use Resources Wisely</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-task-arrays.html">Task Arrays for Data Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-storage.html">Storage Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="90-exercises.html">Additional Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="99-references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/calculquebec/cip201-compute-systems" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2-resources.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Use Resources Wisely</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goal-writing-a-proper-job-script-for-slurm">Goal - Writing a Proper Job Script for Slurm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysing-compute-jobs-on-your-computer">Analysing Compute Jobs on Your Computer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-windows">In Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-mac-os">In Mac OS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-linux">In Linux</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysing-compute-jobs-on-clusters">Analysing Compute Jobs on Clusters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-used-by-a-completed-job">Resources Used by a Completed Job</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-used-by-a-running-job">Resources Used by a Running Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-checking-resources-used-by-a-running-job"><strong>Exercise</strong> - Checking Resources Used by a Running Job</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-checking-resources-used-by-a-running-gpu-job">(Demo) Checking Resources Used by a Running GPU Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-testing-crunch-py-with-one-gpu"><strong>Exercise</strong> - Testing <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> with One GPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-speed-of-cpu-cores-and-a-gpu">Comparing the Speed of CPU Cores and a GPU</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jobs-analysis-via-cluster-portals">Jobs Analysis via Cluster Portals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-required-compute-resources">Estimating Required Compute Resources</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-efficiency-of-a-job">Target Efficiency of a Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-job-efficiency"><strong>Exercise</strong> - Job Efficiency</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapolating-required-compute-resources">Extrapolating Required Compute Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-size-and-number-of-files-to-process">Data Size and Number of Files to Process</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-compute-clusters">Comparison of Compute Clusters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="use-resources-wisely">
<h1>Use Resources Wisely<a class="headerlink" href="#use-resources-wisely" title="Link to this heading">#</a></h1>
<p>With a Digital Research Alliance of Canada account, you have
access to many <strong>high performance computing resources</strong>:</p>
<ul class="simple">
<li><p>Compute clusters:</p>
<ul>
<li><p>Béluga, Cedar, Graham, Narval, Niagara</p></li>
</ul>
</li>
<li><p>Storage :</p>
<ul>
<li><p>Temporary, project, <em>nearline</em></p></li>
</ul>
</li>
</ul>
<p>While being large, but still limited in size, these resources
should be used carefully by everyone in order to maximise the
amount of produced scientific results for themselves and for others.</p>
<section id="goal-writing-a-proper-job-script-for-slurm">
<h2>Goal - Writing a Proper Job Script for Slurm<a class="headerlink" href="#goal-writing-a-proper-job-script-for-slurm" title="Link to this heading">#</a></h2>
<p>Le principal objectif de ce chapitre est de vous permettre d’analyser
vos besoins dans le but de <strong>déterminer les ressources nécessaires</strong>
pour vos tâches de calcul.
Chaque tâche de calcul est définie par un <strong>script de tâche</strong> destiné à
<a class="reference external" href="https://slurm.schedmd.com/documentation.html">l’ordonnanceur Slurm</a>.
Typiquement écrit en commandes Bash, on y retrouve :</p>
<ul class="simple">
<li><p>Le <a class="reference external" href="https://fr.wikipedia.org/wiki/Shebang">shebang</a> en toute
première ligne. Par exemple : <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code></p></li>
<li><p>Les options <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> en entête pour les besoins de la tâche. Les
options en entête seront lues par la commande de soumission de tâche
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html"><code class="docutils literal notranslate"><span class="pre">sbatch</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Utiliser_des_modules">Chargement des modules</a> requis</p></li>
<li><p>Les commandes Bash qui seront exécutées automatiquement sur des
processeurs réservés pour la tâche</p></li>
</ul>
<p>For example : <a class="reference external" href="https://github.com/calculquebec/cip201-compute-systems/blob/main/scripts/mpi-hello.sh"><code class="docutils literal notranslate"><span class="pre">scripts/mpi-hello.sh</span></code></a></p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/mpi-hello.sh
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --ntasks=10</span>
<span class="c1">#SBATCH --mem-per-cpu=1000M</span>
<span class="c1">#SBATCH --time=0-00:10</span>

<span class="n">module</span> <span class="n">load</span> <span class="n">gcc</span><span class="o">/</span><span class="mf">9.3.0</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>

<span class="n">mpirun</span> <span class="n">printenv</span> <span class="n">HOSTNAME</span> <span class="n">OMPI_COMM_WORLD_RANK</span> <span class="n">OMPI_COMM_WORLD_SIZE</span>
</pre></div>
</div>
<p>Our documentation about job scripts starts at this page:
<a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs">Running jobs</a></p>
</section>
<section id="analysing-compute-jobs-on-your-computer">
<h2>Analysing Compute Jobs on Your Computer<a class="headerlink" href="#analysing-compute-jobs-on-your-computer" title="Link to this heading">#</a></h2>
<p>Lorsqu’une tâche est en cours d’exécution sur votre ordinateur,
vous pouvez surveiller différentes métriques :</p>
<ul class="simple">
<li><p>Utilisation CPU (et GPU, s’il y a lieu)</p></li>
<li><p>Mémoire-vive utilisée</p></li>
<li><p>Accès au stockage</p></li>
</ul>
<section id="in-windows">
<h3>In Windows<a class="headerlink" href="#in-windows" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://fr.wikipedia.org/wiki/Gestionnaire_des_t%C3%A2ches_Windows">Gestionnaire des tâches Windows</a></p></li>
<li><p>Pour le faire afficher, on le trouve de deux manières :</p>
<ul>
<li><p>Chercher <em>Gestionnaire des tâches</em> dans le menu Démarrer</p></li>
<li><p>Raccourcis clavier Ctrl+Alt+Suppr</p></li>
</ul>
</li>
</ul>
<p><img alt="Aperçu du gestionnaire des tâches Windows" src="_images/win-task-manager.png" /></p>
</section>
<section id="in-mac-os">
<h3>In Mac OS<a class="headerlink" href="#in-mac-os" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://support.apple.com/fr-ca/guide/activity-monitor/actmntr1001/mac">Moniteur d’activité</a></p></li>
<li><p>Pour le faire afficher :</p>
<ul>
<li><p>Démarrer l’application à partir des <em>Applications et Utilitaires</em> de Mac OS</p></li>
<li><p>Sinon, utiliser le raccourcis clavier Commande+Espace et taper les
premières lettres de “Moniteur d’activité” pour pouvoir sélectionner
cette application</p></li>
</ul>
</li>
</ul>
<p><img alt="Overview of Mac OS Activity Monitor" src="https://help.apple.com/assets/63FD404271C3B6058F265722/63FD404A71C3B6058F265732/en_US/07d6bea6dc9944ae58f6581297196752.png" /></p>
</section>
<section id="in-linux">
<h3>In Linux<a class="headerlink" href="#in-linux" title="Link to this heading">#</a></h3>
<p>Dans un terminal Unix, on peut utiliser :</p>
<ul class="simple">
<li><p>La <a class="reference external" href="https://man7.org/linux/man-pages/man1/top.1.html">commande <code class="docutils literal notranslate"><span class="pre">top</span></code></a> (<code class="docutils literal notranslate"><span class="pre">q</span></code> pour quitter)</p></li>
</ul>
<p><img alt="Capture de top" src="_images/linux-top.png" /></p>
<ul class="simple">
<li><p>La <a class="reference external" href="https://man7.org/linux/man-pages/man1/htop.1.html">commande <code class="docutils literal notranslate"><span class="pre">htop</span></code></a> (<code class="docutils literal notranslate"><span class="pre">q</span></code> pour quitter)</p></li>
</ul>
<p><img alt="Capture de htop" src="_images/linux-htop.png" /></p>
</section>
</section>
<section id="analysing-compute-jobs-on-clusters">
<h2>Analysing Compute Jobs on Clusters<a class="headerlink" href="#analysing-compute-jobs-on-clusters" title="Link to this heading">#</a></h2>
<p>On commence par <strong>se connecter au noeud frontal</strong> de la grappe :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>login1
...
</pre></div>
</div>
<p><strong>Notes</strong> :</p>
<ul class="simple">
<li><p>Pour accéder aux grappes de calcul en production, il vaut mieux
utiliser <a class="reference external" href="https://docs.alliancecan.ca/wiki/Using_SSH_keys_in_Linux/fr">une paire de clés SSH</a>.</p></li>
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Multifactor_authentication/fr">L’authentification multifacteur</a>
est maintenant offerte sur les grappes nationales.
<a class="reference external" href="https://www.youtube.com/watch?v=ciycOUbchl8">Vidéo d’introduction ici</a>.</p></li>
<li><p>Avec votre accès par défaut, vous avez un compte de calcul
<code class="docutils literal notranslate"><span class="pre">def-*</span></code> de base qui vous permet de lancer des tâches.</p></li>
</ul>
<p>To submit a job script, we use the
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html"><code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command</a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>scripts/blastn-gen-seq.sh
</pre></div>
</div>
<p>And to monitor the status of a job, we use the
<a class="reference external" href="https://slurm.schedmd.com/squeue.html"><code class="docutils literal notranslate"><span class="pre">squeue</span></code> command</a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>squeue<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># or &#39;sq&#39;</span>
</pre></div>
</div>
<section id="resources-used-by-a-completed-job">
<h3>Resources Used by a Completed Job<a class="headerlink" href="#resources-used-by-a-completed-job" title="Link to this heading">#</a></h3>
<p>With the <a class="reference external" href="https://slurm.schedmd.com/sacct.html"><code class="docutils literal notranslate"><span class="pre">sacct</span></code> command</a>,
we can get a detailed table of completed jobs since midnight:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sacct
</pre></div>
</div>
<p>With the <a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs#Completed_jobs"><code class="docutils literal notranslate"><span class="pre">seff</span></code> command</a>,
we can get a short report about a single completed job.
This report includes the elapsed time, the total
CPU time and the maximum amount of memory used.
Two values of efficiency are given in percentages of total CPU
usage and maximum memory usage (compared to requested amounts).</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>seff<span class="w"> </span>&lt;Job_ID&gt;
</pre></div>
</div>
</section>
<section id="resources-used-by-a-running-job">
<h3>Resources Used by a Running Job<a class="headerlink" href="#resources-used-by-a-running-job" title="Link to this heading">#</a></h3>
<p>Given some operations on a 3D matrix in the Python script
<a class="reference external" href="https://github.com/calculquebec/cip201-compute-systems/blob/main/scripts/crunch.py"><code class="docutils literal notranslate"><span class="pre">scripts/crunch.py</span></code></a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/crunch.py
</pre></div>
</div>
<p>While an interactive job is running, we can use the <code class="docutils literal notranslate"><span class="pre">top</span></code>
and <code class="docutils literal notranslate"><span class="pre">htop</span></code> commands to monitor resources being used:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interactive job</span>
salloc<span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">4</span><span class="w"> </span>--mem<span class="o">=</span>8000M<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>:15:0

cat<span class="w"> </span>scripts/crunch.sh

<span class="c1"># Run with one CPU core</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--cpu<span class="w"> </span><span class="m">1</span>
top<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># Press Q to quit</span>

<span class="c1"># Run with four CPU cores</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span>
htop<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># Press Q to quit</span>

<span class="c1"># Compare results</span>
grep<span class="w"> </span>sec<span class="w"> </span>*.log

<span class="nb">exit</span><span class="w">  </span><span class="c1"># To go back to login1</span>
</pre></div>
</div>
<p>If you use
<a class="reference external" href="https://docs.alliancecan.ca/wiki/JupyterHub">JupyterHub</a>
to profile your codes, you can visualize in real time the
use of the <em>Machine Resources</em> in the tab <em>GPU Dashboards</em>:</p>
<p><img alt="GPU Dashboard for CPU" src="_images/nv-dashboard_cpu.png" /></p>
<section id="exercise-checking-resources-used-by-a-running-job">
<h4><strong>Exercise</strong> - Checking Resources Used by a Running Job<a class="headerlink" href="#exercise-checking-resources-used-by-a-running-job" title="Link to this heading">#</a></h4>
<p>While your job is running, you are allowed to connect by SSH to
the corresponding compute node in order to monitor your processes:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/inv-mat.sh
sbatch<span class="w"> </span>scripts/inv-mat.sh
</pre></div>
</div>
<p>Here are some general steps for job monitoring and validation:</p>
<ul class="simple">
<li><p>Identify on which node your job is running: <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">-u</span> <span class="pre">$USER</span></code></p></li>
<li><p>Connect to that node with: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;node_name&gt;</span></code></p></li>
<li><p>Monitor the job execution with <code class="docutils literal notranslate"><span class="pre">top</span></code> or <code class="docutils literal notranslate"><span class="pre">htop</span></code>:</p>
<ul>
<li><p>Are your processes running at <strong>near 100%?</strong>?</p></li>
<li><p>Are your parallel processes running at <strong>near <span class="math notranslate nohighlight">\(n\)</span> * 100%</strong>,
where <span class="math notranslate nohighlight">\(n\)</span> is the number of reserved CPU cores for the job?</p></li>
<li><p>Does the <strong>compute node</strong> seem fully utilized?</p></li>
</ul>
</li>
<li><p><strong>Inspect results</strong> in <code class="docutils literal notranslate"><span class="pre">time_inv.csv</span></code></p>
<ul>
<li><p>Identify any problem. If any, find the cause</p></li>
<li><p>Correct the code, the compilation, the script
or the parameters used for the compute task</p></li>
<li><p>Resubmit the compute job and redo the above validation steps</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="demo-checking-resources-used-by-a-running-gpu-job">
<h3>(Demo) Checking Resources Used by a Running GPU Job<a class="headerlink" href="#demo-checking-resources-used-by-a-running-gpu-job" title="Link to this heading">#</a></h3>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interactive job</span>
salloc<span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">4</span><span class="w"> </span>--mem<span class="o">=</span>8000M<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>:15:0<span class="w"> </span>--gres<span class="o">=</span>gpu:1
</pre></div>
</div>
<ul class="simple">
<li><p>For Windows and Mac OS, you can install proprietary software
that allows real time visualization of the GPU utilization.
Please check the documentation of the GPU manufacturer for details</p></li>
<li><p>In Linux, with an NVIDIA GPU, we first have the
<a class="reference external" href="https://developer.nvidia.com/nvidia-system-management-interface"><code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> command</a></p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>nvidia-smi
</pre></div>
</div>
<p><img alt="Capture nvidia-smi" src="_images/nvidia-smi.png" /></p>
<ul class="simple">
<li><p>There is also the <a class="reference external" href="https://github.com/Syllo/nvtop"><code class="docutils literal notranslate"><span class="pre">nvtop</span></code></a> project
that allows visualizing the use of one or many GPUs in a terminal:</p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run with one GPU</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--gpu
nvtop<span class="w">  </span><span class="c1"># Press Q to quit</span>
</pre></div>
</div>
<p><img alt="Capture nvtop" src="https://raw.githubusercontent.com/Syllo/nvtop/master/screenshot/NVTOP_ex1.png" /></p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the result</span>
grep<span class="w"> </span>sec<span class="w"> </span>tg.log

<span class="nb">exit</span><span class="w">  </span><span class="c1"># To go back to login1</span>
</pre></div>
</div>
<p>If you use
<a class="reference external" href="https://docs.alliancecan.ca/wiki/JupyterHub">JupyterHub</a>
to profile your GPU software or code, you can visualize in real
time the use of <em>GPU Resources</em> in the tab <em>GPU Dashboards</em>:</p>
<p><img alt="GPU Dashboards for GPU" src="_images/nv-dashboard_gpu.png" /></p>
<section id="exercise-testing-crunch-py-with-one-gpu">
<h4><strong>Exercise</strong> - Testing <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> with One GPU<a class="headerlink" href="#exercise-testing-crunch-py-with-one-gpu" title="Link to this heading">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w">    </span>scripts/crunch-sbatch-1gpu.sh
sbatch<span class="w"> </span>scripts/crunch-sbatch-1gpu.sh

squeue<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># To check the status of the job</span>
tail<span class="w"> </span>-24<span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>slurm-*<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span>
</pre></div>
</div>
</section>
<section id="comparing-the-speed-of-cpu-cores-and-a-gpu">
<h4>Comparing the Speed of CPU Cores and a GPU<a class="headerlink" href="#comparing-the-speed-of-cpu-cores-and-a-gpu" title="Link to this heading">#</a></h4>
<p>Avant d’utiliser massivement les GPUs d’une grappe de calcul, il faut
tout d’abord que l’application ou l’algorithme puisse démontrer une
“bonne performance” en utilisant plusieurs processeurs en parallèle.</p>
<p>Quelques définitions :</p>
<ul class="simple">
<li><p><strong>Temps écoulé</strong> = temps d’exécution total que l’on perçoit et non le temps CPU</p></li>
<li><p><strong>Accélération</strong> = (temps avec un processeur) / (temps avec parallélisme)</p></li>
<li><p><strong>Efficacité</strong> = (Accélération) / (nombre de processeurs)</p></li>
</ul>
<p>Le coût d’un noeud GPU étant cinq fois supérieur à celui d’un noeud
régulier, l’utilisation d’un seul GPU doit permettre une accélération
d’au moins cinq fois (5x) la vitesse de huit (8) à douze (12) processeurs.</p>
<ul class="simple">
<li><p><strong>Accélération</strong> = (temps avec 8 à 12 processeurs) / (temps avec un accélérateur)</p></li>
</ul>
</section>
</section>
<section id="jobs-analysis-via-cluster-portals">
<h3>Jobs Analysis via Cluster Portals<a class="headerlink" href="#jobs-analysis-via-cluster-portals" title="Link to this heading">#</a></h3>
<p>Béluga et Narval ont chacun un portail pour l’analyse des tâches :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://portail.beluga.calculquebec.ca/">https://portail.beluga.calculquebec.ca/</a></p></li>
<li><p><a class="reference external" href="https://portail.narval.calculquebec.ca/">https://portail.narval.calculquebec.ca/</a></p></li>
</ul>
</section>
</section>
<section id="estimating-required-compute-resources">
<h2>Estimating Required Compute Resources<a class="headerlink" href="#estimating-required-compute-resources" title="Link to this heading">#</a></h2>
<section id="target-efficiency-of-a-job">
<h3>Target Efficiency of a Job<a class="headerlink" href="#target-efficiency-of-a-job" title="Link to this heading">#</a></h3>
<p>À coût d’essais et erreurs avec une <strong>tâche de petite taille</strong>,
la cible pour :</p>
<ul class="simple">
<li><p><strong>Le calcul</strong> est une <strong>efficacité d’au moins 90%</strong></p>
<ul>
<li><p>Tâches séquentielles : il faut <strong>optimiser les accès aux données</strong></p>
<ul>
<li><p>Utiliser adéquatement les différents types de stockage</p></li>
</ul>
</li>
<li><p>Tâches parallèles : il existe un <strong>nombre maximal de processeurs</strong>
à utiliser pour respecter ce seuil :</p>
<ul>
<li><p>Principe de <a class="reference external" href="https://docs.alliancecan.ca/wiki/Scalability/fr">scalabilité</a>
et <a class="reference external" href="https://fr.wikipedia.org/wiki/Loi_d%27Amdahl">Loi d’Amdahl</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>La mémoire-vive</strong> est une consommation <strong>de l’ordre de 80%</strong>
de ce qui est demandé à l’ordonnanceur Slurm</p></li>
</ul>
<p><strong>Rappel</strong> - vous pouvez obtenir ces pourcentages via les commandes
<code class="docutils literal notranslate"><span class="pre">sacct</span> <span class="pre">-X</span></code> (surtout pour obtenir les numéros de tâches) et <code class="docutils literal notranslate"><span class="pre">seff</span></code>.
Les valeurs à considérer sont :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Utilized</span></code> et <code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Efficiency</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Utilized</span></code> et <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Efficiency</span></code></p></li>
</ul>
<section id="exercise-job-efficiency">
<h4><strong>Exercise</strong> - Job Efficiency<a class="headerlink" href="#exercise-job-efficiency" title="Link to this heading">#</a></h4>
<p>For some of your jobs listed by the following command:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sacct<span class="w"> </span>-X
</pre></div>
</div>
<p>Get the <code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Efficiency</span></code> and the <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Efficiency</span></code> with the command:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>seff<span class="w"> </span>&lt;Job_ID&gt;
</pre></div>
</div>
</section>
</section>
<section id="extrapolating-required-compute-resources">
<h3>Extrapolating Required Compute Resources<a class="headerlink" href="#extrapolating-required-compute-resources" title="Link to this heading">#</a></h3>
<p>La question qui se pose :
<strong>en augmentant la ou les dimensions du problème</strong>, quelles devraient
être la durée du calcul et la consommation en mémoire-vive?
<a class="reference external" href="https://fr.wikipedia.org/wiki/Analyse_de_la_complexit%C3%A9_des_algorithmes">Une analyse détaillée du code</a>
n’est pas nécessaire pour déterminer le type de calcul qui est fait :</p>
<ul class="simple">
<li><p>Vous pouvez <strong>mesurer le temps d’exécution</strong> (avec la
commande <code class="docutils literal notranslate"><span class="pre">time</span></code>) en fonction de la taille du problème.
En extrapolant les résultats, il serait possible de prévoir
le comportement du programme sur une grappe de calcul.</p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">time</span><span class="w"> </span>-p<span class="w"> </span>sleep<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vous pouvez considérer le <strong>format des données en entrées</strong> pour
deviner l’ordre du calcul principal.</p></li>
</ul>
</section>
<section id="data-size-and-number-of-files-to-process">
<h3>Data Size and Number of Files to Process<a class="headerlink" href="#data-size-and-number-of-files-to-process" title="Link to this heading">#</a></h3>
<p>En plus du temps de calcul et de l’espace mémoire, il faut aussi
considérer <strong>l’utilisation du stockage</strong>. Les valeurs à tenir compte :</p>
<ol class="arabic simple">
<li><p>La <strong>quantité</strong> en octets (ou Go)</p>
<ul class="simple">
<li><p>Peut servir à <strong>estimer</strong> l’utilisation de la mémoire-vive</p></li>
<li><p>Tenir compte de la taille du <strong>stockage local rapide</strong> pour
optimiser les accès aux fichiers</p></li>
</ul>
</li>
<li><p>Le <strong>nombre</strong> de fichiers à traiter</p>
<ul class="simple">
<li><p>Considérer le <strong>parallélisme de données</strong></p></li>
<li><p><strong>Multiplier la durée moyenne</strong> du traitement d’un fichier par
le nombre de fichiers pour estimer la durée d’une tâche</p></li>
<li><p><strong>Multiplier la taille moyenne</strong> des fichiers par leur nombre
pour estimer l’espace en mémoire-vive (par exemple : des images)</p></li>
<li><p>Utiliser le stockage rapide pour <strong>optimiser les accès</strong>
aléatoires et nombreux</p></li>
</ul>
</li>
</ol>
<p>Pour obtenir le nombre de fichiers et la taille totale :</p>
<ul class="simple">
<li><p><strong>Sous Windows</strong> : dans l’explorateur Windows (raccourcis clavier : Windows + E)</p>
<ul>
<li><p>Sélectionner un dossier ou plusieurs fichiers</p></li>
<li><p>Bouton droit de la souris -&gt; <em>Propriétés</em></p></li>
</ul>
</li>
</ul>
<p><img alt="Windows data properties" src="_images/win-data-size.png" /></p>
<ul class="simple">
<li><p><strong>Sous Mac OS</strong> : dans <em>Finder</em></p>
<ul>
<li><p>Sélectionner un dossier ou plusieurs fichiers</p></li>
<li><p>Bouton droit de la souris -&gt; <em>Get Info</em></p></li>
<li><p>Autrement : avec l’affichage <em>Par liste</em></p>
<ul>
<li><p><a class="reference external" href="https://www.solutionenligne.org/comment-afficher-taille-dossiers-fichiers-dans-finder-mac-os/">Activer <em>Calculer toutes les tailles</em></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p><strong>In Linux</strong> and on <strong>compute clusters</strong> :</p>
<ul>
<li><p>The graphical environment can provide similar tools, but
it depends on the Linux distribution and the chosen desktop</p></li>
<li><p>The command <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sb</span> <span class="pre">DIRECTORY</span></code> (<code class="docutils literal notranslate"><span class="pre">s</span></code> for total sum, <code class="docutils literal notranslate"><span class="pre">b</span></code> for
apparent size in bytes) recursively computes and displays
the total size of used space in bytes. The apparent size is
important to consider while transferring or backuping the data</p></li>
<li><p>The command <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">DIRECTORY</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code> recursively counts
and displays the number of files and subdirectories</p></li>
</ul>
</li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>du<span class="w"> </span>-sb<span class="w"> </span>data
find<span class="w"> </span>data<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
</section>
</section>
<section id="comparison-of-compute-clusters">
<h2>Comparison of Compute Clusters<a class="headerlink" href="#comparison-of-compute-clusters" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>About compute clusters:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga/en">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p><strong>Availability</strong></p></td>
<td class="text-center"><p>March 2019</p></td>
<td class="text-center"><p>June 2017</p></td>
<td class="text-center"><p>June 2017</p></td>
<td class="text-center"><p>October 2021</p></td>
<td class="text-center"><p>April 2018</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p><strong>City</strong></p></td>
<td class="text-center"><p>Montréal</p></td>
<td class="text-center"><p>Burnaby</p></td>
<td class="text-center"><p>Waterloo</p></td>
<td class="text-center"><p>Montréal</p></td>
<td class="text-center"><p>Toronto</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p><strong>Province</strong></p></td>
<td class="text-center"><p>Québec</p></td>
<td class="text-center"><p>B.C.</p></td>
<td class="text-center"><p>Ontario</p></td>
<td class="text-center"><p>Québec</p></td>
<td class="text-center"><p>Ontario</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Number of CPU cores (number of nodes * CPU cores per node) :</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>AMD/Intel CPU</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga/en">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>Broadwell (avx2)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>724 * 32</p></td>
<td class="text-center"><p>983 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Skylake (avx512)</p></td>
<td class="text-center"><p>802 * 40</p></td>
<td class="text-center"><p>640 * 48</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1548 * 40</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Cascade Lake (avx512)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>768 * 48</p></td>
<td class="text-center"><p>136 * 44</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>476 * 40</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>EPYC Rome (avx2)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1181 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Memory per core</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga/en">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>2400M</p></td>
<td class="text-center"><p>160 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>4000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1408 * 48</p></td>
<td class="text-center"><p>903 * 32</p></td>
<td class="text-center"><p>1145 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>576 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>4400M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>136 * 44</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4800M</p></td>
<td class="text-center"><p>589 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>2024 * 40</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>8000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>96 * 32</p></td>
<td class="text-center"><p>56 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>16000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>19200M</p></td>
<td class="text-center"><p>53 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>32000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>36 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>48000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p>3 * 64</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>96000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>4 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Using_GPUs_with_Slurm">Number of GPUs</a>
per cluster:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>GPU Model</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga/en">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.scinet.utoronto.ca/index.php/Mist">Mist (Power9)</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">Narval</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>NVIDIA P100 12G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>456</p></td>
<td class="text-center"><p>320</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA P100 16G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>128</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>NVIDIA T4 16G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>144</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA V100 16G</p></td>
<td class="text-center"><p>688</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>54</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>NVIDIA V100 32G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>768</p></td>
<td class="text-center"><p>16</p></td>
<td class="text-center"><p>216</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA A100 40G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>636</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Other specifications :</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga/en">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>Fast network</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>OmniPath</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>InfiniBand</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Topology</p></td>
<td class="text-center"><p>Fat Tree</p></td>
<td class="text-center"><p>Fat Tree</p></td>
<td class="text-center"><p>Fat Tree</p></td>
<td class="text-center"><p>Fat Tree</p></td>
<td class="text-center"><p>DragonFly+</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Island size (core)</p></td>
<td class="text-center"><p>640-1200</p></td>
<td class="text-center"><p>1024-1536</p></td>
<td class="text-center"><p>1024</p></td>
<td class="text-center"><p>3072-3584</p></td>
<td class="text-center"><p>17280</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Blocking factor</p></td>
<td class="text-center"><p>max 5:1</p></td>
<td class="text-center"><p>max 2:1</p></td>
<td class="text-center"><p>max 8:1</p></td>
<td class="text-center"><p>max 4.7:1</p></td>
<td class="text-center"><p>max 2:1</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Job granularity (by)</p></td>
<td class="text-center"><p>core, GPU</p></td>
<td class="text-center"><p>core, GPU</p></td>
<td class="text-center"><p>core, GPU</p></td>
<td class="text-center"><p>core, GPU</p></td>
<td class="text-center"><p>node</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Maximum time</p></td>
<td class="text-center"><p>7 days</p></td>
<td class="text-center"><p>28 days</p></td>
<td class="text-center"><p>7 days</p></td>
<td class="text-center"><p>7 days</p></td>
<td class="text-center"><p>1 day</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Storage: all will be described in the last chapter.</p></li>
</ul>
</section>
<section id="key-points">
<h2>Key Points<a class="headerlink" href="#key-points" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Prévoir les <strong>paramètres d’une tâche Slurm</strong></p>
<ul>
<li><p>Nombre de processeurs (CPU) et de noeuds de calcul</p></li>
<li><p>Nombre d’accélérateurs (GPU)</p></li>
<li><p>Quantité de mémoire-vive (RAM)</p></li>
<li><p>Temps du calcul (<code class="docutils literal notranslate"><span class="pre">JJ-H:M</span></code> ou <code class="docutils literal notranslate"><span class="pre">H:M:S</span></code>)</p></li>
</ul>
</li>
<li><p>Différents <strong>outils pour surveiller</strong> les ressources utilisées</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code> et autres bibliothèques de mesure du temps écoulé</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">htop</span></code>, <code class="docutils literal notranslate"><span class="pre">nvtop</span></code>, <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sacct</span></code>, <code class="docutils literal notranslate"><span class="pre">seff</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sb</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code> et autres outils du système d’exploitation</p></li>
</ul>
</li>
<li><p>On vise une <strong>efficacité de 90%</strong> et plus pour les tâches CPU</p>
<ul>
<li><p>L’accélération avec un accélérateur (GPU) doit être significative (&gt;5x)</p></li>
</ul>
</li>
<li><p>Le choix de la grappe dépend des besoins de chaque type de calcul</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1-introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="3-task-arrays.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Task Arrays for Data Parallelism</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goal-writing-a-proper-job-script-for-slurm">Goal - Writing a Proper Job Script for Slurm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysing-compute-jobs-on-your-computer">Analysing Compute Jobs on Your Computer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-windows">In Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-mac-os">In Mac OS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-linux">In Linux</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysing-compute-jobs-on-clusters">Analysing Compute Jobs on Clusters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-used-by-a-completed-job">Resources Used by a Completed Job</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-used-by-a-running-job">Resources Used by a Running Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-checking-resources-used-by-a-running-job"><strong>Exercise</strong> - Checking Resources Used by a Running Job</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-checking-resources-used-by-a-running-gpu-job">(Demo) Checking Resources Used by a Running GPU Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-testing-crunch-py-with-one-gpu"><strong>Exercise</strong> - Testing <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> with One GPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-speed-of-cpu-cores-and-a-gpu">Comparing the Speed of CPU Cores and a GPU</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jobs-analysis-via-cluster-portals">Jobs Analysis via Cluster Portals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-required-compute-resources">Estimating Required Compute Resources</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-efficiency-of-a-job">Target Efficiency of a Job</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-job-efficiency"><strong>Exercise</strong> - Job Efficiency</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapolating-required-compute-resources">Extrapolating Required Compute Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-size-and-number-of-files-to-process">Data Size and Number of Files to Process</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-compute-clusters">Comparison of Compute Clusters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Calcul Québec Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>